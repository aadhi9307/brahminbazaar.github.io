<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Seller Portal — BrahminBazaar</title>
  
  <style>
    :root{
      /* --- THEME: Clean Yellow & Neutral White (Matching Index/Admin) --- */
      --yellow-outline: #F1C40F;  
      --yellow-hover: #FFFDE7;    
      --yellow-text: #D4AC0D;     
      --bg: #FAFAFA;              
      --card: #FFFFFF;            
      --text: #333333;            
      --muted: #777777;           
      --shadow: 0 4px 15px rgba(0,0,0,0.04); 
      --radius: 12px;
      --max: 1200px;
      --success-green: #2E7D32;
    }
  
    *{box-sizing:border-box;margin:0;padding:0; -webkit-tap-highlight-color: transparent; outline: none;}
    body{min-height:100vh; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; padding-bottom: 40px;}
    
    /* Header */
    header{background:var(--card);position:sticky;top:0;z-index:60; border-bottom:1px solid #EEE; padding: 15px 20px;}
    .wrap{max-width:var(--max);margin:0 auto;display:flex;align-items:center;justify-content:space-between;}
    .brand{display:flex;align-items:center;gap:12px; font-weight: 800; font-size: 1.2rem; color: var(--text);}
    .brand img { height: 40px; }
    .nav-link { text-decoration: none; color: var(--muted); font-weight: 600; font-size: 0.9rem; transition: 0.2s; }
    .nav-link:hover { color: var(--yellow-text); }

    /* Main Container */
    main { max-width: 800px; margin: 30px auto; padding: 0 20px; }
    
    .card { background: var(--card); border-radius: var(--radius); padding: 30px; box-shadow: var(--shadow); border: 1px solid #EEE; margin-bottom: 25px; }
    h2 { margin-bottom: 10px; color: var(--text); }
    p.desc { color: var(--muted); margin-bottom: 25px; line-height: 1.5; }

    /* Forms */
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; font-size: 0.9rem; font-weight: 700; color: var(--muted); margin-bottom: 8px; }
    .form-group input, .form-group textarea, .form-group select { 
        width: 100%; padding: 12px; border: 1px solid #DDD; border-radius: 8px; font-size: 1rem; transition: 0.2s; background: #fff;
    }
    .form-group input:focus, .form-group textarea:focus { border-color: var(--yellow-outline); background: var(--yellow-hover); }

    /* Buttons */
    .btn-primary {
        background: #000; color: #FFF; border: none; width: 100%; padding: 15px; border-radius: 8px; 
        font-weight: 700; font-size: 1rem; cursor: pointer; transition: 0.2s;
    }
    .btn-primary:hover { background: var(--yellow-outline); color: #000; }
    
    .btn-secondary {
        background: #FFF; border: 1px solid #DDD; color: var(--text); padding: 8px 14px; border-radius: 6px; 
        font-weight: 600; cursor: pointer; font-size: 0.9rem;
    }
    .btn-secondary:hover { background: var(--yellow-hover); border-color: var(--yellow-outline); }

    /* Dashboard Specifics */
    .status-banner {
        background: linear-gradient(to right, #FFFDE7, #FFFFFF); border: 1px solid var(--yellow-outline);
        padding: 20px; border-radius: 12px; margin-bottom: 30px; display: flex; align-items: center; justify-content: space-between;
    }
    .welcome-text h3 { margin-bottom: 5px; }
    .welcome-text small { color: var(--muted); }
    .logout-btn { color: #D32F2F; text-decoration: underline; cursor: pointer; font-size: 0.9rem; font-weight: 600;}

    /* Variety/Size Row Logic */
    .variety-group { border: 1px dashed #DDD; border-radius: 8px; padding: 15px; background: #FAFAFA; margin-bottom: 15px; }
    .variety-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
    .variety-header input { font-weight: 700; }
    .size-row { display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 8px; margin-bottom: 8px; }
    .btn-remove { color: red; background: none; border: none; font-size: 1.2rem; cursor: pointer; }

    /* Tabs */
    .tabs { display: flex; gap: 20px; border-bottom: 2px solid #EEE; margin-bottom: 25px; }
    .tab { padding-bottom: 10px; cursor: pointer; font-weight: 600; color: var(--muted); border-bottom: 3px solid transparent; }
    .tab.active { color: var(--text); border-color: var(--yellow-outline); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Submitted Requests List */
    .req-item { padding: 15px; border: 1px solid #EEE; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
    .req-badge { background: #FFF3E0; color: #EF6C00; font-size: 0.8rem; padding: 4px 8px; border-radius: 4px; font-weight: 700; }

    /* Success Message */
    #toast {
        position: fixed; bottom: 20px; left: 50%; transform: translate(-50%, 100px);
        background: #333; color: #fff; padding: 12px 24px; border-radius: 50px; opacity: 0; transition: 0.3s;
        display: flex; align-items: center; gap: 10px; z-index: 100;
    }
    #toast.show { transform: translate(-50%, 0); opacity: 1; }

  </style>
</head>
<body>

  <header>
    <div class="wrap">
      <div class="brand">
        <img src="logo.png" alt="BrahminBazaar" onerror="this.style.display='none'">
        <span>BrahminBazaar Partner</span>
      </div>
      <a href="index.html" class="nav-link">← Back to Shop</a>
    </div>
  </header>

  <main>
    
    <section id="sectionRegister" style="display:none;">
      <div class="card">
        <h2>Become a Seller</h2>
        <p class="desc">Join our network. Please fill in your details below to register.</p>
        
        <form id="regForm">
          <div class="form-group">
            <label>Full Name *</label>
            <input id="r_name" required placeholder="e.g. Suryanarayana Sharma">
          </div>
          
          <div class="form-group">
            <label>Business / Shop Name (Optional)</label>
            <input id="r_shop" placeholder="e.g. Sharma Home Foods">
          </div>

          <div class="form-group">
            <label>Place / City *</label>
            <input id="r_place" required placeholder="e.g. Srikalahasti, Andhra Pradesh">
          </div>

          <div class="form-group">
            <label>Mobile Number *</label>
            <input id="r_phone" type="tel" required placeholder="10 digit mobile number">
          </div>

          <div class="form-group">
            <label>Email ID *</label>
            <input id="r_email" type="email" required placeholder="e.g. yourname@gmail.com">
          </div>

          <div class="form-group">
            <label>Selling Experience / Current Platforms *</label>
            <textarea id="r_exp" rows="3" required placeholder="Do you have a retail shop? Do you sell on WhatsApp/Amazon? Tell us briefly."></textarea>
          </div>

          <button type="submit" class="btn-primary"> Register </button>
        </form>
      </div>
    </section>

    <section id="sectionDashboard" style="display:none;">
      
      <div class="status-banner">
        <div class="welcome-text">
          <h3 id="dashName">Welcome, Partner!</h3>
          <small id="dashPlace">Location</small>
        </div>
        <span class="logout-btn" onclick="logout()">Logout</span>
      </div>

      <div class="tabs">
        <div class="tab active" onclick="switchTab('tabNew')">Add Product Request</div>
        <div class="tab" onclick="switchTab('tabHistory')">My Requests</div>
      </div>

      <div id="tabNew" class="tab-content active">
        <div class="card">
            <h3>Submit New Product</h3>
            <p class="desc">Fill in the product details. This request will be sent to the Admin panel.</p>
            
            <form id="prodForm">
                <div class="form-group">
                    <label>Product Name *</label>
                    <input id="p_title" required placeholder="e.g. Homemade Mango Pickle">
                </div>

                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px">
                    <div class="form-group">
                        <label>Department</label>
                        <select id="p_dept">
                            <option value="Groceries">Groceries</option>
                            <option value="Cosmetics">Cosmetics</option>
                            <option value="Pooja Items">Pooja Items</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Sub-Category</label>
                        <input id="p_cat" required placeholder="e.g. Pickles, Powders">
                    </div>
                </div>

                <div class="form-group">
                    <label>Image Link (URL)</label>
                    <input id="p_img" placeholder="https://...">
                    <small style="color:#999; display:block; margin-top:5px">Leave empty if you will provide image via WhatsApp later.</small>
                </div>

                <div class="form-group">
                    <label>Product Description</label>
                    <textarea id="p_desc" rows="3" placeholder="Ingredients, shelf life, specialties..."></textarea>
                </div>

                <div class="form-group">
                    <label style="margin-bottom:10px; display:block">Varieties & Pricing *</label>
                    <div id="varietiesContainer"></div>
                    <button type="button" class="btn-secondary" onclick="addVarietyBlock()" style="width:100%; margin-top:10px">+ Add Variety / Size</button>
                </div>

                <button type="submit" class="btn-primary" style="margin-top:20px">Submit Request to Admin</button>
            </form>
        </div>
      </div>

      <div id="tabHistory" class="tab-content">
        <div class="card">
            <h3>Submitted Requests</h3>
            <div id="reqList" style="margin-top:20px">
                <p style="color:#999; text-align:center">No requests submitted yet.</p>
            </div>
        </div>
      </div>

    </section>

  </main>

  <div id="toast">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#FFF" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
    <span id="toastMsg">Success!</span>
  </div>

  <script>
    /*
     * SELLER PORTAL LOGIC
     * Uses localStorage to simulate backend persistence.
     */

    // Keys
    const KEY_SESSION = 'bb_seller_session';
    const KEY_REQUESTS = 'bb_seller_requests'; // Where product requests are stored for Admin

    // State
    let SESSION = null;

    function init() {
        const stored = localStorage.getItem(KEY_SESSION);
        if (stored) {
            SESSION = JSON.parse(stored);
            showDashboard();
        } else {
            showRegister();
        }
        
        // Initialize one variety block for the form
        addVarietyBlock(); 
    }

    /* --- VIEW SWITCHING --- */
    function showRegister() {
        document.getElementById('sectionRegister').style.display = 'block';
        document.getElementById('sectionDashboard').style.display = 'none';
    }

    function showDashboard() {
        document.getElementById('sectionRegister').style.display = 'none';
        document.getElementById('sectionDashboard').style.display = 'block';
        
        document.getElementById('dashName').textContent = `Welcome, ${SESSION.name}`;
        document.getElementById('dashPlace').textContent = `${SESSION.shop ? SESSION.shop + ', ' : ''}${SESSION.place}`;
        
        loadHistory();
    }

    window.switchTab = (tabId) => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        // Find click trigger based on onclick string or manual mapping (simple way here)
        const tabs = document.querySelectorAll('.tab');
        if(tabId === 'tabNew') tabs[0].classList.add('active');
        else tabs[1].classList.add('active');
        
        document.getElementById(tabId).classList.add('active');
    };

    /* --- REGISTRATION LOGIC --- */
    document.getElementById('regForm').onsubmit = (e) => {
        e.preventDefault();
        
        const data = {
            name: document.getElementById('r_name').value,
            shop: document.getElementById('r_shop').value,
            place: document.getElementById('r_place').value,
            phone: document.getElementById('r_phone').value,
            email: document.getElementById('r_email').value, // Captured Email
            exp: document.getElementById('r_exp').value,
            joined: new Date().toISOString()
        };

        // 1. Save Session
        localStorage.setItem(KEY_SESSION, JSON.stringify(data));
        SESSION = data;

        // 2. Email Logic (Direct mailto trigger)
        // Recipient: vyasallp@gmail.com
        // Subject: Register as Seller
        const subject = "Register as Seller";
        const body = `Namaste Admin,%0D%0A%0D%0AI would like to register as a seller.%0D%0A%0D%0AName: ${data.name}%0D%0AShop: ${data.shop}%0D%0APlace: ${data.place}%0D%0APhone: ${data.phone}%0D%0AEmail: ${data.email}%0D%0AExperience: ${data.exp}%0D%0A%0D%0APlease approve my account.`;
        
        window.open(`mailto:vyasallp@gmail.com?subject=${subject}&body=${body}`, '_blank');

        // 3. UI Update
        showToast("Registration Successful! Welcome.");
        showDashboard();
    };

    window.logout = () => {
        if(confirm("Logout from Seller Portal?")) {
            localStorage.removeItem(KEY_SESSION);
            location.reload();
        }
    };

    /* --- PRODUCT FORM LOGIC (Matches Admin Structure) --- */
    
    // Add Variety Block
    window.addVarietyBlock = () => {
        const div = document.createElement('div');
        div.className = 'variety-group';
        div.innerHTML = `
            <div class="variety-header">
                <input type="text" class="inp-variety-name" placeholder="Variety Name (e.g. Standard / Premium)" style="border:none; border-bottom:1px dashed #999; width:70%">
                <button type="button" class="btn-remove" onclick="this.closest('.variety-group').remove()">×</button>
            </div>
            <div class="sizes-container">
                <div class="size-row">
                    <input type="text" class="inp-size" placeholder="Size (e.g. 500g)" required>
                    <input type="number" class="inp-price" placeholder="Price ₹" required>
                    <input type="number" class="inp-stock" placeholder="Qty" required>
                </div>
            </div>
            <button type="button" class="btn-secondary" style="font-size:0.8rem; padding:4px 8px" onclick="addSizeRow(this)">+ Add Size Option</button>
        `;
        document.getElementById('varietiesContainer').appendChild(div);
    };

    // Add Size Row inside a variety
    window.addSizeRow = (btn) => {
        const container = btn.previousElementSibling;
        const row = document.createElement('div');
        row.className = 'size-row';
        row.innerHTML = `
            <input type="text" class="inp-size" placeholder="Size" required>
            <input type="number" class="inp-price" placeholder="₹" required>
            <input type="number" class="inp-stock" placeholder="Qty" required>
            <button type="button" class="btn-remove" onclick="this.parentElement.remove()">×</button>
        `;
        container.appendChild(row);
    };

    document.getElementById('prodForm').onsubmit = (e) => {
        e.preventDefault();
        
        // Harvest Data
        const title = document.getElementById('p_title').value;
        const dept = document.getElementById('p_dept').value;
        const subCat = document.getElementById('p_cat').value;
        const img = document.getElementById('p_img').value || 'https://via.placeholder.com/150';
        const desc = document.getElementById('p_desc').value;

        // Harvest Options
        const options = [];
        document.querySelectorAll('.variety-group').forEach(grp => {
            const vName = grp.querySelector('.inp-variety-name').value || 'Standard';
            grp.querySelectorAll('.size-row').forEach(row => {
                const s = row.querySelector('.inp-size').value;
                const p = row.querySelector('.inp-price').value;
                const st = row.querySelector('.inp-stock').value;
                if(s && p) {
                    options.push({
                        label: vName === 'Standard' ? s : `${vName} - ${s}`,
                        variety: vName,
                        size: s,
                        price: Number(p),
                        stock: Number(st)
                    });
                }
            });
        });

        if(options.length === 0) return alert("Please add at least one size/price option.");

        const productRequest = {
            id: 'REQ-' + Date.now(),
            sellerName: SESSION.name,
            sellerPhone: SESSION.phone,
            sellerEmail: SESSION.email, // Include email in requests
            status: 'Pending Approval', // Status for Admin to see
            timestamp: new Date().toISOString(),
            // Product Data Structure (Compatible with Admin)
            productData: {
                id: title.toLowerCase().replace(/[^a-z0-9]/g, '-') + '-' + Math.floor(Math.random()*1000),
                title, dept, subCategory: subCat,
                img, images: [img],
                description: desc,
                options,
                inStock: true
            }
        };

        // Save to Requests Queue
        const allReqs = JSON.parse(localStorage.getItem(KEY_REQUESTS) || '[]');
        allReqs.push(productRequest);
        localStorage.setItem(KEY_REQUESTS, JSON.stringify(allReqs));

        showToast("Request sent to Admin!");
        e.target.reset();
        document.getElementById('varietiesContainer').innerHTML = '';
        addVarietyBlock(); // Reset form
        loadHistory();
        window.switchTab('tabHistory');
    };

    function loadHistory() {
        const allReqs = JSON.parse(localStorage.getItem(KEY_REQUESTS) || '[]');
        const myReqs = allReqs.filter(r => r.sellerPhone === SESSION.phone).reverse();
        
        const list = document.getElementById('reqList');
        if(myReqs.length === 0) {
            list.innerHTML = `<p style="color:#999; text-align:center">No requests submitted yet.</p>`;
            return;
        }

        list.innerHTML = myReqs.map(r => `
            <div class="req-item">
                <div>
                    <div style="font-weight:700">${r.productData.title}</div>
                    <div style="font-size:0.85rem; color:var(--muted)">${r.productData.subCategory} • ${new Date(r.timestamp).toLocaleDateString()}</div>
                </div>
                <div class="req-badge">${r.status}</div>
            </div>
        `).join('');
    }

    function showToast(msg) {
        const t = document.getElementById('toast');
        document.getElementById('toastMsg').textContent = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
    }

    // Run
    init();

  </script>
</body>
</html>